{% extends "rightsplace/layout.html" %}
{% load static %}

{% block title %}Submit Report â€” RightsPlace{% endblock %}

{% block extra_css %}
<style>
    /* Drag & Drop Area */
    #drop-area {
        border: 2px dashed #6c757d;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        background-color: #f8f9fa;
        transition: border-color .3s ease, background-color .3s ease;
    }
    #drop-area.dragover {
        border-color: #0d6efd;
        background-color: #eaf2ff;
    }

    /* File List */
    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        margin-bottom: 6px;
    }

    .file-remove-btn {
        border: none;
        background: transparent;
        color: #dc3545;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

    <!-- HEADER -->
    <div class="text-center mb-4">
        <h1 class="fw-bold">Submit a Report</h1>
        <p class="text-muted">Provide details and attach files as supporting evidence</p>
    </div>

    <!-- MESSAGES -->
    {% if messages %}
        <div>
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- REPORT FORM -->
    <div class="card shadow-sm p-4">
        <form id="reportForm" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            <!-- Normal Form Fields -->
            {{ form.non_field_errors }}
            <div class="mb-3">
                {{ form.title.label_tag }}
                {{ form.title }}
                {{ form.title.errors }}
            </div>

            <div class="mb-3">
                {{ form.description.label_tag }}
                {{ form.description }}
                {{ form.description.errors }}
            </div>

            <div class="mb-3">
                {{ form.category.label_tag }}
                {{ form.category }}
                {{ form.category.errors }}
            </div>

            <div class="mb-3">
                {{ form.incident_location.label_tag }}
                {{ form.incident_location }}
                {{ form.incident_location.errors }}
            </div>

            <!-- FILE UPLOAD FIELD (Hidden due to JS reinterface) -->
            <div class="mb-3 d-none">
                {{ form.evidence_files }}
            </div>

            <!-- Drag & Drop zone -->
            <div id="drop-area" class="mb-3">
                <h5 class="mb-2">Drag & drop files here</h5>
                <p class="text-muted small">or click to select files</p>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="pick-files-btn">
                    Choose Files
                </button>
            </div>

            <!-- File List -->
            <div id="file-list" class="mb-3"></div>

            <!-- Progress Bar -->
            <div class="progress mb-3 d-none" id="upload-progress-container">
                <div id="upload-progress" class="progress-bar" role="progressbar"
                     style="width: 0%;">0%</div>
            </div>

            <button type="submit" class="btn btn-primary w-100">Submit Report</button>
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'rightsplace/report_create.js' %}"></script>
{% endblock %}
