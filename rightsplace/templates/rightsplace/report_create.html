{% extends "rightsplace/layout.html" %}
{% load static %}

{% block title %}Submit Report â€” RightsPlace{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/report_create.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="mb-4 fw-bold">Submit an Incident Report</h2>

    {% if messages %}
      {% for m in messages %}
        <div class="alert alert-{{ m.tags|default:'info' }}">{{ m }}</div>
      {% endfor %}
    {% endif %}

    {% if success %}
        <div class="alert alert-success">
            Your report has been submitted successfully.
        </div>
    {% endif %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for err in form.non_field_errors %}
          <div>{{ err }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form id="reportForm" method="POST" enctype="multipart/form-data" novalidate>
        {% csrf_token %}

        <!-- TITLE -->
        <div class="mb-3">
            <label class="form-label">Title</label>
            {{ form.title }}
            {% if form.title.errors %}
                <div class="text-danger small mt-1">
                    {% for err in form.title.errors %}{{ err }}<br>{% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- DESCRIPTION -->
        <div class="mb-3">
            <label class="form-label">Description</label>
            {{ form.description }}
            {% if form.description.errors %}
                <div class="text-danger small mt-1">
                    {% for err in form.description.errors %}{{ err }}<br>{% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- CATEGORY -->
        <div class="mb-3">
            <label class="form-label">Category</label>
            {{ form.category }}
            {% if form.category.errors %}
                <div class="text-danger small mt-1">
                    {% for err in form.category.errors %}{{ err }}<br>{% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- INCIDENT LOCATION -->
        <div class="mb-3">
            <label class="form-label">Incident Location</label>
            {{ form.incident_location }}
            {% if form.incident_location.errors %}
                <div class="text-danger small mt-1">
                    {% for err in form.incident_location.errors %}{{ err }}<br>{% endfor %}
                </div>
            {% endif %}
        </div>


        <!-- REAL DJANGO FILE INPUT (fully hidden) -->
        <div style="height:0; overflow:hidden; opacity:0; position:absolute;">
            {{ form.evidence_files }}
        </div>


        <!-- DRAG & DROP ZONE -->
        <div id="dropZone"
             class="border border-2 border-secondary rounded p-4 text-center bg-white mb-3"
             style="cursor:pointer;">
            <p class="text-muted mb-1">Drag & drop evidence files here, or click to select.</p>
            <small class="text-muted">
                You may upload images, video, audio, PDF, DOCX, XLSX, or TXT. Max 25 MB per file.
            </small>

            <!-- VISIBLE FILE INPUT used by JS -->
            <input type="file" id="fileInput" multiple hidden aria-hidden="true">
        </div>

        <!-- PREVIEW + ERRORS -->
        <div id="fileArea">
            <ul id="fileList" class="list-group mb-3"></ul>
            <div id="fileErrors" class="text-danger small mb-3" style="display:none;"></div>
        </div>

        <button type="submit" class="btn btn-primary px-4">Submit Report</button>
    </form>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'rightsplace/report_create.js' %}"></script>
{% endblock %}
