{% extends "rightsplace/layout.html" %}
{% load static %}

{% block title %}Report Anonymously â€” RightsPlace{% endblock %}

{% block extra_css %}
<style>
    #drop-area {
        border: 2px dashed #6c757d;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        background-color: #f8f9fa;
        transition: border-color .3s ease, background-color .3s ease;
    }
    #drop-area.dragover {
        border-color: #0d6efd;
        background-color: #eaf2ff;
    }

    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        margin-bottom: 6px;
    }

    .file-remove-btn {
        border: none;
        background: transparent;
        color: #dc3545;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

    <!-- HEADER -->
    <div class="text-center mb-4">
        <h1 class="fw-bold">Report Anonymously</h1>
        <p class="text-muted">
            Your identity will not be recorded. You may attach evidence if available.
        </p>
    </div>

    <!-- SUCCESS MESSAGE (hidden by default) -->
    <div id="success-box" class="alert alert-success d-none">
        <h5 class="fw-bold mb-2">Report submitted successfully</h5>
        <p class="mb-0">
            Thank you for speaking up. Your report has been received and will be reviewed.
        </p>
    </div>

    <!-- FORM CARD -->
    <div class="card shadow-sm p-4" id="form-card">
        <form id="anonymousReportForm" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            {{ form.non_field_errors }}

            <div class="mb-3">
                {{ form.title.label_tag }}
                {{ form.title }}
                {{ form.title.errors }}
            </div>

            <div class="mb-3">
                {{ form.description.label_tag }}
                {{ form.description }}
                {{ form.description.errors }}
            </div>

            <div class="mb-3">
                {{ form.category.label_tag }}
                {{ form.category }}
                {{ form.category.errors }}
            </div>

            <div class="mb-3">
                {{ form.incident_location.label_tag }}
                {{ form.incident_location }}
                {{ form.incident_location.errors }}
            </div>

            <!-- Hidden Django file input -->
            <div class="d-none">
                {{ form.evidence_files }}
            </div>

            <!-- Drag & Drop -->
            <div id="drop-area" class="mb-3">
                <h6 class="mb-2">Drag & drop evidence files here</h6>
                <p class="text-muted small mb-2">or click to select files</p>
                <button type="button"
                        class="btn btn-outline-secondary btn-sm"
                        id="pick-files-btn">
                    Choose Files
                </button>
            </div>

            <!-- File List -->
            <div id="file-list" class="mb-3"></div>

            <!-- Progress Bar -->
            <div class="progress mb-3 d-none" id="upload-progress-container">
                <div id="upload-progress"
                     class="progress-bar"
                     role="progressbar"
                     style="width: 0%">
                    0%
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-100">
                Submit Anonymous Report
            </button>
        </form>
    </div>

</div>
{% endblock %}

{% block script %}
<script src="{% static 'rightsplace/anonymous_report.js' %}"></script>
{% endblock %}
